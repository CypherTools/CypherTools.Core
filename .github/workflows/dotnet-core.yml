name: NuGet Generation

on:
  push:
    branches:
      - main
  pull_request:
    types: [closed]
    branches:
      - main

jobs:
  build:
    runs-on: windows-latest
    name: Update NuGet package
    steps:

      - name: Checkout repository
        uses: actions/checkout@v1

      - name: Setup .NET Core @ Latest
        uses: actions/setup-dotnet@v1
      - name: Build solution and generate NuGet package
        run: |  
          cd ./src
          dotnet pack -c Release -o out  
      - name: Push Nupkg to GitHub Packages
        # You may pin to the exact commit or the version.
        # uses: tanaka-takayoshi/nuget-publish-to-github-packages-action@462b6006e5c90f732d030b0ace2c3e7ee9d550bc
        uses: tanaka-takayoshi/nuget-publish-to-github-packages-action@v2.1
        with:
          # Path of NuPkg
          nupkg-path: ./src/out/CypherTools.Core*.nupkg
          # package repository owner
          repo-owner: CypherTools
          # user account
          gh-user: CypherTools
          # access token
          token: ${{secrets.GITHUB_TOKEN}}  
          # skip publishing duplicated package(s)
          skip-duplicate: true
